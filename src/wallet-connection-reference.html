<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WordMint - Solana Wallet Connection Reference</title>
  <style>
    /* ============================================
       DESIGN SYSTEM
       ============================================ */
    
    :root {
      /* Colors */
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #64748b;
      
      /* Accent Colors */
      --accent-primary: #8b5cf6;
      --accent-secondary: #06b6d4;
      --accent-success: #10b981;
      --accent-warning: #f59e0b;
      --accent-error: #ef4444;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.3);
      
      /* Spacing */
      --space-xs: 0.5rem;
      --space-sm: 1rem;
      --space-md: 1.5rem;
      --space-lg: 2rem;
      --space-xl: 3rem;
      
      /* Border Radius */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-md);
    }
    
    /* ============================================
       CONTAINER & LAYOUT
       ============================================ */
    
    .container {
      max-width: 500px;
      width: 100%;
    }
    
    .card {
      background: var(--bg-secondary);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(139, 92, 246, 0.1);
    }
    
    /* ============================================
       TYPOGRAPHY
       ============================================ */
    
    h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: var(--space-sm);
      text-align: center;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: var(--space-md);
      text-align: center;
    }
    
    p {
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: var(--space-md);
      text-align: center;
    }
    
    /* ============================================
       BADGES & LABELS
       ============================================ */
    
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: var(--space-md);
    }
    
    .badge-info {
      background: rgba(6, 182, 212, 0.1);
      color: var(--accent-secondary);
      border: 1px solid rgba(6, 182, 212, 0.2);
    }
    
    .badge-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .badge-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--accent-warning);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }
    
    .badge-devnet {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-success);
      border: 1px solid rgba(16, 185, 129, 0.2);
      font-family: 'Courier New', monospace;
    }
    
    /* ============================================
       BUTTONS
       ============================================ */
    
    .btn {
      width: 100%;
      padding: 1rem 1.5rem;
      border: none;
      border-radius: var(--radius-lg);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--accent-primary), #6366f1);
      color: white;
      box-shadow: var(--shadow-glow);
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
    }
    
    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: var(--bg-secondary);
      border-color: var(--accent-primary);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-icon {
      width: 20px;
      height: 20px;
    }
    
    /* ============================================
       LOADING SPINNER
       ============================================ */
    
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ============================================
       WALLET STATUS COMPONENT
       ============================================ */
    
    .wallet-status {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      margin-bottom: var(--space-md);
      border: 1px solid rgba(139, 92, 246, 0.2);
    }
    
    .wallet-info {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    
    .wallet-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
    }
    
    .wallet-details {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    
    .wallet-address {
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      color: var(--text-primary);
      font-weight: 600;
    }
    
    .wallet-network {
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent-success);
      box-shadow: 0 0 10px var(--accent-success);
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* ============================================
       ALERT BOXES
       ============================================ */
    
    .alert {
      padding: var(--space-md);
      border-radius: var(--radius-lg);
      margin-bottom: var(--space-md);
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
    }
    
    .alert-info {
      background: rgba(6, 182, 212, 0.1);
      border: 1px solid rgba(6, 182, 212, 0.2);
      color: var(--accent-secondary);
    }
    
    .alert-warning {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.2);
      color: var(--accent-warning);
    }
    
    .alert-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--accent-error);
    }
    
    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      color: var(--accent-success);
    }
    
    .alert-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }
    
    .alert-content {
      flex: 1;
    }
    
    .alert-title {
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .alert-message {
      font-size: 0.875rem;
      line-height: 1.5;
      opacity: 0.9;
    }
    
    /* ============================================
       STEP INDICATOR
       ============================================ */
    
    .steps {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      margin: var(--space-md) 0;
      padding: var(--space-md);
      background: var(--bg-tertiary);
      border-radius: var(--radius-lg);
    }
    
    .step {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-size: 0.875rem;
      color: var(--text-secondary);
    }
    
    .step-number {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: rgba(139, 92, 246, 0.2);
      color: var(--accent-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    /* ============================================
       UTILITY CLASSES
       ============================================ */
    
    .hidden {
      display: none !important;
    }
    
    .text-center {
      text-align: center;
    }
    
    .mb-0 { margin-bottom: 0; }
    .mb-sm { margin-bottom: var(--space-sm); }
    .mb-md { margin-bottom: var(--space-md); }
    .mb-lg { margin-bottom: var(--space-lg); }
    
    .mt-sm { margin-top: var(--space-sm); }
    .mt-md { margin-top: var(--space-md); }
    
    /* ============================================
       DEVELOPER ANNOTATIONS
       ============================================ */
    
    .dev-note {
      background: rgba(245, 158, 11, 0.1);
      border-left: 4px solid var(--accent-warning);
      padding: var(--space-sm);
      margin: var(--space-md) 0;
      font-size: 0.875rem;
      color: var(--accent-warning);
      font-family: 'Courier New', monospace;
    }
    
    .dev-note strong {
      display: block;
      margin-bottom: 0.25rem;
      color: var(--accent-warning);
    }
    
    /* ============================================
       ANIMATIONS
       ============================================ */
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    /* ============================================
       RESPONSIVE
       ============================================ */
    
    @media (max-width: 640px) {
      .card {
        padding: var(--space-md);
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      h2 {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card fade-in">
      <!-- HEADER -->
      <h1>ðŸŽ® WordMint</h1>
      
      <!-- DEVICE DETECTION BADGE -->
      <div class="text-center mb-md">
        <span class="badge badge-info" id="deviceBadge">
          <!-- Populated by JavaScript -->
        </span>
      </div>
      
      <!-- ============================================
           STATE 1: WALLET NOT INSTALLED (Desktop Only)
           ============================================ -->
      <div id="state-not-installed" class="hidden">
        <h2>Install Phantom Wallet</h2>
        <p>Phantom wallet extension is not detected. Install it to connect your Solana wallet.</p>
        
        <div class="alert alert-warning">
          <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          <div class="alert-content">
            <div class="alert-title">Wallet Extension Required</div>
            <div class="alert-message">Install the Phantom browser extension to continue.</div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="installPhantom()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
          Install Phantom Wallet
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE:</strong>
          Desktop only state. Detects !window.solana. Opens phantom.app/download.
        </div>
      </div>
      
      <!-- ============================================
           STATE 2: WALLET DETECTED (Desktop)
           ============================================ -->
      <div id="state-detected-desktop" class="hidden">
        <h2>Connect Your Wallet</h2>
        <p>Phantom wallet detected! Connect to start playing WordMint on Solana devnet.</p>
        
        <div class="alert alert-success">
          <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="alert-content">
            <div class="alert-title">Wallet Ready</div>
            <div class="alert-message">Click below to connect your Phantom wallet.</div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="connectWalletDesktop()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M21 18v1a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h14a2 2 0 012 2v1"/>
            <polyline points="15 10 20 10 20 14 15 14"/>
          </svg>
          Connect Wallet
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE - BLOCKCHAIN CALL #1:</strong>
          onClick triggers: await window.solana.connect()<br>
          Returns: { publicKey: PublicKey }<br>
          User sees: Phantom extension popup for approval
        </div>
      </div>
      
      <!-- ============================================
           STATE 3: CONNECTING (Desktop)
           ============================================ -->
      <div id="state-connecting-desktop" class="hidden">
        <h2>Connecting Wallet...</h2>
        <p>Check the Phantom popup to approve the connection request.</p>
        
        <div class="alert alert-info">
          <div class="spinner"></div>
          <div class="alert-content">
            <div class="alert-title">Approval Required</div>
            <div class="alert-message">Waiting for you to approve in the Phantom extension popup...</div>
          </div>
        </div>
        
        <button class="btn btn-secondary" disabled>
          <div class="spinner"></div>
          Connecting...
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE:</strong>
          Promise pending. Phantom extension shows popup.<br>
          User can approve or reject.<br>
          State transitions to 'connected' or 'rejected' based on response.
        </div>
      </div>
      
      <!-- ============================================
           STATE 4: MOBILE INITIAL STATE
           ============================================ -->
      <div id="state-mobile-initial" class="hidden">
        <h2>Connect with Phantom</h2>
        <p>You'll be redirected to the Phantom app to approve the connection. You'll automatically return here after approval.</p>
        
        <div class="steps">
          <div class="step">
            <div class="step-number">1</div>
            <div>Phantom app will open</div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div>Approve connection in the app</div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div>Return to this browser automatically</div>
          </div>
        </div>
        
        <div class="alert alert-info">
          <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
          </svg>
          <div class="alert-content">
            <div class="alert-title">Mobile Deep Link</div>
            <div class="alert-message">The Phantom app will open in a new window.</div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="connectWalletMobile()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
          </svg>
          Connect with Phantom
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE - SOLANA MOBILE WALLET ADAPTER:</strong>
          onClick triggers deep link: phantom://v1/connect<br>
          Initiates authorization request via Solana Mobile Wallet Adapter<br>
          User approves in Phantom app â†’ returns via redirect URL
        </div>
      </div>
      
      <!-- ============================================
           STATE 5: MOBILE OPENING APP
           ============================================ -->
      <div id="state-mobile-opening" class="hidden">
        <h2>Opening Phantom...</h2>
        <p>The Phantom app should open automatically. If it doesn't, tap the button below.</p>
        
        <div class="alert alert-info">
          <div class="spinner"></div>
          <div class="alert-content">
            <div class="alert-title">Redirecting to Phantom</div>
            <div class="alert-message">Please approve the connection in the Phantom app. You'll return here automatically.</div>
          </div>
        </div>
        
        <button class="btn btn-secondary" disabled>
          <div class="spinner"></div>
          Opening Phantom App...
        </button>
        
        <button class="btn btn-secondary mt-sm" onclick="connectWalletMobile()">
          Retry Opening Phantom
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE:</strong>
          Deep link initiated. Waiting for user to return from Phantom app.<br>
          Listen for URL parameters on page load: ?phantom_encryption_public_key=...
        </div>
      </div>
      
      <!-- ============================================
           STATE 6: WALLET CONNECTED (Success)
           ============================================ -->
      <div id="state-connected" class="hidden">
        <div class="alert alert-success mb-md">
          <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="alert-content">
            <div class="alert-title">Wallet Connected!</div>
            <div class="alert-message">Your Solana wallet is now connected to WordMint.</div>
          </div>
        </div>
        
        <!-- WALLET STATUS COMPONENT -->
        <div class="wallet-status">
          <div class="wallet-info">
            <div class="wallet-avatar">
              <svg fill="currentColor" viewBox="0 0 24 24" width="20" height="20">
                <path d="M21 18v1a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h14a2 2 0 012 2v1"/>
              </svg>
            </div>
            <div class="wallet-details">
              <div class="wallet-address" id="walletAddress">ABC1...XYZ9</div>
              <div class="wallet-network">
                <span class="badge-devnet">Solana Devnet</span>
              </div>
            </div>
          </div>
          <div class="status-indicator"></div>
        </div>
        
        <h2>Ready to Play!</h2>
        <p>Your wallet is connected. Start earning WMINT tokens by spelling Web3 words correctly.</p>
        
        <button class="btn btn-primary" onclick="continueToGame()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
          </svg>
          Continue to Game
        </button>
        
        <button class="btn btn-secondary mt-sm" onclick="disconnectWallet()">
          Disconnect Wallet
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE:</strong>
          Connected state. publicKey stored in localStorage.<br>
          Wallet status component persists across all game screens.<br>
          Can disconnect via: await window.solana.disconnect()
        </div>
      </div>
      
      <!-- ============================================
           STATE 7: CONNECTION REJECTED
           ============================================ -->
      <div id="state-rejected" class="hidden">
        <h2>Connection Declined</h2>
        <p>You declined the wallet connection request. No worries, you can try again anytime.</p>
        
        <div class="alert alert-warning">
          <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          <div class="alert-content">
            <div class="alert-title">Connection Cancelled</div>
            <div class="alert-message">You need to connect a wallet to play WordMint.</div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="retryConnection()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Try Again
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE:</strong>
          Error code 4001 = user rejection.<br>
          Silent handling - no scary error messages.<br>
          User can retry without penalty.
        </div>
      </div>
      
      <!-- ============================================
           STATE 8: CONNECTION ERROR
           ============================================ -->
      <div id="state-error" class="hidden">
        <h2>Connection Failed</h2>
        <p>There was an error connecting to your wallet. Please try again.</p>
        
        <div class="alert alert-error">
          <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="alert-content">
            <div class="alert-title">Connection Error</div>
            <div class="alert-message" id="errorMessage">Unknown error occurred.</div>
          </div>
        </div>
        
        <div class="steps">
          <div class="step">
            <div class="step-number">âœ“</div>
            <div>Make sure Phantom is unlocked</div>
          </div>
          <div class="step">
            <div class="step-number">âœ“</div>
            <div>Check your internet connection</div>
          </div>
          <div class="step">
            <div class="step-number">âœ“</div>
            <div>Try refreshing the page</div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="retryConnection()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Retry Connection
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE:</strong>
          Real errors (not user rejection).<br>
          Common: wallet locked, network error, extension crashed.<br>
          Log to console for debugging.
        </div>
      </div>
      
      <!-- ============================================
           STATE 9: RETURN FROM MOBILE (Confirmation)
           ============================================ -->
      <div id="state-mobile-return" class="hidden">
        <div class="alert alert-success mb-md">
          <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="alert-content">
            <div class="alert-title">Welcome Back!</div>
            <div class="alert-message">Your wallet connection was successful.</div>
          </div>
        </div>
        
        <!-- WALLET STATUS COMPONENT -->
        <div class="wallet-status">
          <div class="wallet-info">
            <div class="wallet-avatar">P</div>
            <div class="wallet-details">
              <div class="wallet-address" id="returnWalletAddress">ABC1...XYZ9</div>
              <div class="wallet-network">
                <span class="badge-devnet">Solana Devnet</span>
              </div>
            </div>
          </div>
          <div class="status-indicator"></div>
        </div>
        
        <h2>Connection Confirmed</h2>
        <p>You've successfully returned from the Phantom app. Your wallet is now connected and ready to use.</p>
        
        <button class="btn btn-primary" onclick="continueToGame()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14 5l7 7m0 0l-7 7m7-7H3"/>
          </svg>
          Continue to Game
        </button>
        
        <div class="dev-note mt-md">
          <strong>DEV NOTE:</strong>
          Mobile return confirmation screen.<br>
          URL contains: ?phantom_encryption_public_key=...<br>
          Session established. Store publicKey in localStorage.<br>
          Auto-redirect after 3 seconds or manual continue.
        </div>
      </div>
    </div>
  </div>
  
  <script>
    /* ============================================
       WALLET CONNECTION STATE MACHINE
       ============================================ */
    
    // State management
    let currentState = 'initial';
    let walletPublicKey = null;
    let isMobile = false;
    let walletProvider = null;
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      initializeWalletFlow();
    });
    
    /**
     * INITIALIZATION
     * Detects device type and wallet availability
     */
    function initializeWalletFlow() {
      // Device detection
      isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      // Update device badge
      const badge = document.getElementById('deviceBadge');
      if (isMobile) {
        badge.innerHTML = `
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
          </svg>
          Mobile browser detected
        `;
      } else {
        badge.innerHTML = `
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
          Desktop browser detected
        `;
      }
      
      // Check for mobile return
      if (checkMobileReturn()) {
        return; // Handle mobile return flow
      }
      
      // Check for existing connection
      const savedWallet = localStorage.getItem('wordmint_wallet');
      if (savedWallet) {
        walletPublicKey = savedWallet;
        setState('connected');
        return;
      }
      
      // Desktop wallet detection
      if (!isMobile) {
        if (window.solana && window.solana.isPhantom) {
          console.log('âœ… Phantom wallet detected');
          walletProvider = window.solana;
          setState('detected-desktop');
        } else {
          console.log('âŒ No wallet detected');
          setState('not-installed');
        }
      } else {
        // Mobile - always show mobile flow
        setState('mobile-initial');
      }
    }
    
    /**
     * CHECK MOBILE RETURN
     * Checks URL parameters for mobile wallet adapter response
     */
    function checkMobileReturn() {
      const urlParams = new URLSearchParams(window.location.search);
      
      // Phantom mobile returns with encryption public key
      if (urlParams.has('phantom_encryption_public_key')) {
        console.log('ðŸ“± Returned from Phantom mobile app');
        
        // In a real implementation, you would:
        // 1. Decrypt the response using your app's private key
        // 2. Verify the signature
        // 3. Extract the wallet public key
        
        // For this demo, simulate a successful connection
        const mockPublicKey = 'ABC123...XYZ789'; // In reality, extract from encrypted response
        walletPublicKey = mockPublicKey;
        
        // Store in localStorage
        localStorage.setItem('wordmint_wallet', walletPublicKey);
        
        // Show return confirmation
        setState('mobile-return');
        
        // Auto-redirect to connected state after 3 seconds
        setTimeout(() => {
          setState('connected');
        }, 3000);
        
        return true;
      }
      
      return false;
    }
    
    /**
     * STATE MANAGEMENT
     * Shows/hides UI based on current state
     */
    function setState(newState) {
      console.log(`ðŸ”„ State transition: ${currentState} â†’ ${newState}`);
      
      // Hide all states
      document.querySelectorAll('[id^="state-"]').forEach(el => {
        el.classList.add('hidden');
      });
      
      // Show new state
      const stateElement = document.getElementById(`state-${newState}`);
      if (stateElement) {
        stateElement.classList.remove('hidden');
        currentState = newState;
      } else {
        console.error(`âŒ State not found: ${newState}`);
      }
      
      // Update wallet address displays
      if (newState === 'connected' || newState === 'mobile-return') {
        updateWalletDisplay();
      }
    }
    
    /**
     * DESKTOP WALLET CONNECTION
     * Triggers window.solana.connect()
     */
    async function connectWalletDesktop() {
      console.log('ðŸ”Œ Initiating desktop wallet connection...');
      setState('connecting-desktop');
      
      try {
        // BLOCKCHAIN CALL #1: Connect to Phantom
        console.log('ðŸ“¡ BLOCKCHAIN CALL: window.solana.connect()');
        const response = await window.solana.connect();
        
        console.log('âœ… Wallet connected:', response.publicKey.toString());
        
        // Store wallet address
        walletPublicKey = response.publicKey.toString();
        localStorage.setItem('wordmint_wallet', walletPublicKey);
        
        // Transition to connected state
        setState('connected');
        
      } catch (error) {
        console.error('âŒ Connection error:', error);
        
        // Check if user rejected
        if (error.code === 4001 || error.message.includes('User rejected')) {
          console.log('â„¹ï¸ User rejected connection (not an error)');
          setState('rejected');
        } else {
          console.error('âš ï¸ Real connection error:', error);
          document.getElementById('errorMessage').textContent = error.message || 'Failed to connect to wallet';
          setState('error');
        }
      }
    }
    
    /**
     * MOBILE WALLET CONNECTION
     * Initiates deep link to Phantom app
     */
    function connectWalletMobile() {
      console.log('ðŸ“± Initiating mobile wallet connection...');
      setState('mobile-opening');
      
      // SOLANA MOBILE WALLET ADAPTER
      // Generate a unique session ID
      const session = generateSessionId();
      
      // Store session for verification on return
      localStorage.setItem('wordmint_wallet_session', session);
      
      // Build deep link URL
      const appUrl = window.location.origin + window.location.pathname;
      const redirectUrl = `${appUrl}?session=${session}`;
      
      // Phantom deep link format
      const deepLink = `https://phantom.app/ul/v1/connect?app_url=${encodeURIComponent(appUrl)}&redirect_link=${encodeURIComponent(redirectUrl)}&ref=wordmint`;
      
      console.log('ðŸ”— Deep link:', deepLink);
      console.log('ðŸ“¡ SOLANA MOBILE WALLET ADAPTER: Initiating authorization');
      
      // Redirect to Phantom
      window.location.href = deepLink;
      
      // Note: User will leave the page here
      // They will return via the redirect_link after approving in Phantom
    }
    
    /**
     * UTILITY: Generate Session ID
     */
    function generateSessionId() {
      return 'session_' + Math.random().toString(36).substring(2, 15);
    }
    
    /**
     * UPDATE WALLET DISPLAY
     * Updates wallet address in UI components
     */
    function updateWalletDisplay() {
      if (!walletPublicKey) return;
      
      // Shorten address: ABC1...XYZ9 format
      const shortened = walletPublicKey.length > 16
        ? `${walletPublicKey.slice(0, 4)}...${walletPublicKey.slice(-4)}`
        : walletPublicKey;
      
      // Update all wallet address displays
      document.querySelectorAll('[id*="walletAddress"]').forEach(el => {
        el.textContent = shortened;
      });
      
      // Update wallet avatar (first letter)
      document.querySelectorAll('.wallet-avatar').forEach(el => {
        if (el.textContent.length < 3) { // Not an icon
          el.textContent = walletPublicKey[0].toUpperCase();
        }
      });
    }
    
    /**
     * DISCONNECT WALLET
     */
    async function disconnectWallet() {
      console.log('ðŸ”Œ Disconnecting wallet...');
      
      try {
        if (walletProvider && walletProvider.disconnect) {
          await walletProvider.disconnect();
        }
        
        // Clear local storage
        localStorage.removeItem('wordmint_wallet');
        localStorage.removeItem('wordmint_wallet_session');
        
        walletPublicKey = null;
        
        console.log('âœ… Wallet disconnected');
        
        // Return to initial state
        initializeWalletFlow();
        
      } catch (error) {
        console.error('âŒ Disconnect error:', error);
      }
    }
    
    /**
     * RETRY CONNECTION
     */
    function retryConnection() {
      console.log('ðŸ”„ Retrying connection...');
      
      if (isMobile) {
        setState('mobile-initial');
      } else {
        setState('detected-desktop');
      }
    }
    
    /**
     * INSTALL PHANTOM
     */
    function installPhantom() {
      console.log('ðŸ“¥ Redirecting to Phantom download...');
      window.open('https://phantom.app/download', '_blank');
    }
    
    /**
     * CONTINUE TO GAME
     */
    function continueToGame() {
      console.log('ðŸŽ® Continuing to game...');
      alert('In the real app, this would navigate to the game dashboard.\n\nWallet: ' + walletPublicKey);
      
      // In real implementation:
      // window.location.href = '/dashboard';
      // or trigger React state change
    }
    
    /* ============================================
       STATE TRANSITIONS SUMMARY
       ============================================
       
       Desktop Flow:
       1. not-installed â†’ (install wallet) â†’ detected-desktop
       2. detected-desktop â†’ (click connect) â†’ connecting-desktop
       3. connecting-desktop â†’ (user approves) â†’ connected
       3. connecting-desktop â†’ (user rejects) â†’ rejected
       3. connecting-desktop â†’ (error) â†’ error
       
       Mobile Flow:
       1. mobile-initial â†’ (click connect) â†’ mobile-opening
       2. mobile-opening â†’ (deep link opens Phantom app)
       3. (User approves in Phantom)
       4. mobile-return â†’ (auto-redirect after 3s) â†’ connected
       
       All States Can:
       - rejected â†’ (retry) â†’ detected-desktop or mobile-initial
       - error â†’ (retry) â†’ detected-desktop or mobile-initial
       - connected â†’ (disconnect) â†’ detected-desktop or mobile-initial
       
       ============================================ */
  </script>
</body>
</html>
